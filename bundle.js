"use strict";(()=>{var r=window.document;var d=window.navigator;var l=class{constructor(e,a,c){return new window.XRWebGLLayer(e,a,c)}};function t(n){let e=r.getElementsByClassName("console-dom").item(0);e.textContent+=`${n}.    `}async function y(){await d.xr.isSessionSupported("immersive-ar")?t("immersive-ar is supported"):t("immersive-ar is not supported")}function v(n){n.addEventListener("end",e=>{e.isTrusted&&t(`event = ${e.type}(${e.target})`)}),n.addEventListener("frameratechange",e=>{e.isTrusted&&t(`event = ${e.type}(${e.target})`)}),n.addEventListener("inputsourceschange",e=>{e.isTrusted&&t(`event = ${e.type}(${e.target})`)}),n.addEventListener("select",e=>{e.isTrusted&&t(`event = ${e.type}(${e.target})`)}),n.addEventListener("selectend",e=>{e.isTrusted&&t(`event = ${e.type}(${e.target})`)}),n.addEventListener("selectstart",e=>{e.isTrusted&&t(`event = ${e.type}(${e.target})`)}),n.addEventListener("squeeze",e=>{e.isTrusted&&t(`event = ${e.type}(${e.target})`)}),n.addEventListener("squeezeend",e=>{e.isTrusted&&t(`event = ${e.type}(${e.target})`)}),n.addEventListener("visibilitychange",e=>{e.isTrusted&&t(`event = ${e.type}(${e.target})`)})}function m(n){t("[START] - describeSession"),t(`session.enabledFeatures = ${n.enabledFeatures}`),t(`session.supportedFrameRates = ${n.supportedFrameRates}`),t(`session.frameRate = ${n.frameRate}`),t(`session.inputSources = ${JSON.stringify(n.inputSources)}`),n.inputSources.forEach(a=>{t(`inputSource.gripSpace = ${a.gripSpace}`);let c=a.gripSpace;t(`${c?.toString()}`),t(`inputSource.handedness = ${a.handedness}`),t(`inputSource.profiles = ${a.profiles}`),t(`inputSource.skipRendering = ${a.skipRendering}`),t(`inputSource.targetRayMode = ${a.targetRayMode}`),t(`inputSource.targetRaySpace = ${a.targetRaySpace}`),t(`${a?.targetRaySpace.toString()}`),t("[START] - WebXR Hand Input Module"),a.hand?t("hand input module is active"):t("hand input module is not active"),t("[END] - WebXR Hand Input Module")}),t(`session.isSystemKeyboardSupported = ${n.isSystemKeyboardSupported}`),t(`session.renderState = ${JSON.stringify(n.renderState)}`),t(`session.visibilityState = ${n.visibilityState}`);let e=n.renderState;t(`renderState.baseLayer = ${e.baseLayer}`),t(`renderState.depthFar = ${e.depthFar}`),t(`renderState.depthNear = ${e.depthNear}`),t(`renderState.inlineVerticalFieldOfView = ${e.inlineVerticalFieldOfView}`),t(`renderState.passthroughFullyObscured = ${e.passthroughFullyObscured}`),t("[START] - WebXR AR Module"),t(`session.environmentBlendMode = ${n.environmentBlendMode}`),t(`session.interactionMode = ${n.interactionMode}`),t("[END] - WebXR AR Module"),t("[START] - WebXR Depth Sensing Module"),t(`session.depthUsage = ${n.depthUsage}`),t(`session.depthDataFormat = ${n.depthDataFormat}`),t(`session.depthType = ${n.depthType}`),t(`session.depthActive = ${n.depthActive}`),t("[END] - WebXR Depth Sensing Module"),t("[END] - describeSession")}async function u(n,e){try{return e.includes("depth-sensing")?await d.xr.requestSession("immersive-ar",{requiredFeatures:[...n,...e],optionalFeatures:["secondary-views","layers"],depthSensing:{usagePreference:["cpu-optimized","gpu-optimized"],dataFormatPreference:["luminance-alpha","float32"]}}):await d.xr.requestSession("immersive-ar",{requiredFeatures:[...n,...e],optionalFeatures:["secondary-views","layers"]})}catch(a){throw t(`requestSession error = ${a.toString()}`),new Error(a.toString())}}async function p(n){v(n);let a=r.createElement("canvas").getContext("webgl2",{xrCompatible:!0}),c={depthFar:1e3,depthNear:.1,passthroughFullyObscured:!0,inlineVerticalFieldOfView:null,baseLayer:new l(n,a)};n.updateRenderState(c),m(n)}function g(){let n=new Set,e=new Set;r.querySelectorAll(".label").forEach(o=>{o.addEventListener("click",i=>{i.isTrusted&&i.target.previousElementSibling.click()})}),r.addEventListener("dispatchReferenceType",async o=>{let i=await u(Array.from(n),Array.from(e));await p(i)}),r.addEventListener("dispatchModule",async o=>{let i=await u(Array.from(n),Array.from(e));await p(i)}),r.querySelectorAll(".referenceSpaceType").forEach(o=>{o.addEventListener("click",i=>{let s=i.target;s.checked?n.add(s.value):n.delete(s.value),r.dispatchEvent(new CustomEvent("dispatchReferenceType",{detail:n}))})}),r.querySelectorAll(".module").forEach(o=>{o.addEventListener("click",i=>{let s=i.target;s.checked?e.add(s.value):e.delete(s.value),r.dispatchEvent(new CustomEvent("dispatchModule",{detail:e}))})})}async function S(){r.featurePolicy.allowsFeature("xr-spatial-tracking")?t("xr-spatial-tracking is supported"):t("xr-spatial-tracking is not supported"),d.xr.addEventListener("devicechange",n=>{n.isTrusted&&t(`event = ${n.type}(${n.target})`)}),d.xr.ondevicechange=n=>{t(`navigator.xr.ondevicechange = ${n.target}`),n.isTrusted&&t(`event = ${n.type}(${n.target})`)},t("\u6A5F\u80FD\u78BA\u8A8D"),g(),await y()}S();})();
