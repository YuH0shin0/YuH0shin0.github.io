"use strict";(()=>{var r=window.document;var c=window.navigator;var l=class{constructor(a,n,d){return new window.XRWebGLLayer(a,n,d)}};function e(t){let a=r.getElementsByClassName("console-dom").item(0);a.textContent+=`${t}.    `}async function S(){await c.xr.isSessionSupported("immersive-ar")?e("immersive-ar is supported"):e("immersive-ar is not supported")}function p(t){e("[START] - describeSession"),e(`session.enabledFeatures = ${t.enabledFeatures}`),e(`session.supportedFrameRates = ${t.supportedFrameRates}`),e(`session.frameRate = ${t.frameRate}`),e(`session.inputSources = ${JSON.stringify(t.inputSources)}`),t.inputSources.forEach(n=>{e(`inputSource.gripSpace = ${n.gripSpace}`);let d=n.gripSpace;e(`${d?.toString()}`),e(`inputSource.handedness = ${n.handedness}`),e(`inputSource.profiles = ${n.profiles}`),e(`inputSource.skipRendering = ${n.skipRendering}`),e(`inputSource.targetRayMode = ${n.targetRayMode}`),e(`inputSource.targetRaySpace = ${n.targetRaySpace}`),e(`${n?.targetRaySpace.toString()}`),e("[START] - WebXR Hand Input Module"),n.hand?e("hand input module is active"):e("hand input module is not active"),e("[END] - WebXR Hand Input Module")}),e(`session.isSystemKeyboardSupported = ${t.isSystemKeyboardSupported}`),e(`session.renderState = ${JSON.stringify(t.renderState)}`),e(`session.visibilityState = ${t.visibilityState}`);let a=t.renderState;e(`renderState.baseLayer = ${a.baseLayer}`),e(`renderState.depthFar = ${a.depthFar}`),e(`renderState.depthNear = ${a.depthNear}`),e(`renderState.inlineVerticalFieldOfView = ${a.inlineVerticalFieldOfView}`),e(`renderState.passthroughFullyObscured = ${a.passthroughFullyObscured}`),e("[START] - WebXR AR Module"),e(`session.environmentBlendMode = ${t.environmentBlendMode}`),e(`session.interactionMode = ${t.interactionMode}`),e("[END] - WebXR AR Module"),e("[START] - WebXR Depth Sensing Module"),e(`session.depthUsage = ${t.depthUsage}`),e(`session.depthDataFormat = ${t.depthDataFormat}`),e(`session.depthType = ${t.depthType}`),e(`session.depthActive = ${t.depthActive}`),e("[END] - WebXR Depth Sensing Module"),e("[END] - describeSession")}async function m(t,a){try{return a.includes("depth-sensing")?await c.xr.requestSession("immersive-ar",{requiredFeatures:[...t,...a],optionalFeatures:["secondary-views","layers"],depthSensing:{usagePreference:["cpu-optimized","gpu-optimized"],dataFormatPreference:["luminance-alpha","float32"]}}):await c.xr.requestSession("immersive-ar",{requiredFeatures:[...t,...a],optionalFeatures:["secondary-views","layers"]})}catch(n){throw e(`requestSession error = ${n.toString()}`),new Error(n.toString())}}async function y(t){p(t);let n=r.createElement("canvas").getContext("webgl2",{xrCompatible:!0});n.viewport(0,0,n.canvas.width,n.canvas.height),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT);let d=new l(t,n),u={depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:Math.PI*.5,passthroughFullyObscured:!0,baseLayer:d};t.updateRenderState(u),p(t),setTimeout(()=>{let s={depthNear:.1,depthFar:1e3,inlineVerticalFieldOfView:Math.PI*.5,passthroughFullyObscured:!1,baseLayer:d};t.updateRenderState(s),p(t)},1e4)}function v(){let t=new Set,a=new Set;r.querySelectorAll(".label").forEach(s=>{s.addEventListener("click",i=>{i.isTrusted&&i.target.previousElementSibling.click()})}),r.addEventListener("dispatchReferenceType",async s=>{let i=await m(Array.from(t),Array.from(a));await y(i)}),r.addEventListener("dispatchModule",async s=>{let i=await m(Array.from(t),Array.from(a));await y(i)}),r.querySelectorAll(".referenceSpaceType").forEach(s=>{s.addEventListener("click",i=>{let o=i.target;o.checked?t.add(o.value):t.delete(o.value),r.dispatchEvent(new CustomEvent("dispatchReferenceType",{detail:t}))})}),r.querySelectorAll(".module").forEach(s=>{s.addEventListener("click",i=>{let o=i.target;o.checked?a.add(o.value):a.delete(o.value),r.dispatchEvent(new CustomEvent("dispatchModule",{detail:a}))})})}async function g(){r.featurePolicy.allowsFeature("xr-spatial-tracking")?e("xr-spatial-tracking is supported"):e("xr-spatial-tracking is not supported"),e("\u6A5F\u80FD\u78BA\u8A8D"),v(),await S()}g();})();
