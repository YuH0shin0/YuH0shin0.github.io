"use strict";(()=>{var i=window.document;var c=window.navigator;var l=class{constructor(n,a,o){return new window.XRWebGLLayer(n,a,o)}};function e(t){let n=i.getElementsByClassName("console-dom").item(0);n.textContent+=`${t}\r
`}async function m(){await c.xr.isSessionSupported("immersive-ar")?e("immersive-ar is supported"):e("immersive-ar is not supported")}function S(t){e("[START] - describeSession"),e(`session.enabledFeatures = ${t.enabledFeatures}`),e(`session.supportedFrameRates = ${t.supportedFrameRates}`),e(`session.frameRate = ${t.frameRate}`),e(`session.inputSources = ${JSON.stringify(t.inputSources)}`),t.inputSources.forEach(a=>{e(`inputSource.gripSpace = ${a.gripSpace}`);let o=a.gripSpace;e(`${o?.toString()}`),e(`inputSource.handedness = ${a.handedness}`),e(`inputSource.profiles = ${a.profiles}`),e(`inputSource.skipRendering = ${a.skipRendering}`),e(`inputSource.targetRayMode = ${a.targetRayMode}`),e(`inputSource.targetRaySpace = ${a.targetRaySpace}`),e(`${a?.targetRaySpace.toString()}`),e("[START] - WebXR Hand Input Module"),a.hand?e("hand input module is active"):e("hand input module is not active"),e("[END] - WebXR Hand Input Module")}),e(`session.isSystemKeyboardSupported = ${t.isSystemKeyboardSupported}`),e(`session.renderState = ${JSON.stringify(t.renderState)}`),e(`session.visibilityState = ${t.visibilityState}`);let n=t.renderState;e(`renderState.baseLayer = ${n.baseLayer}`),e(`renderState.depthFar = ${n.depthFar}`),e(`renderState.depthNear = ${n.depthNear}`),e(`renderState.inlineVerticalFieldOfView = ${n.inlineVerticalFieldOfView}`),e(`renderState.passthroughFullyObscured = ${n.passthroughFullyObscured}`),e("[START] - WebXR AR Module"),e(`session.environmentBlendMode = ${t.environmentBlendMode}`),e(`session.interactionMode = ${t.interactionMode}`),e("[END] - WebXR AR Module"),e("[START] - WebXR Depth Sensing Module"),e(`session.depthUsage = ${t.depthUsage}`),e(`session.depthDataFormat = ${t.depthDataFormat}`),e(`session.depthType = ${t.depthType}`),e(`session.depthActive = ${t.depthActive}`),e("[END] - WebXR Depth Sensing Module"),e("[END] - describeSession")}var y=null;function v(t,n){e(`frameCallback of requestAnimationFrame(${t}, ${n})`),e(`session = ${n.session}`),e(`predictedDisplayTime = ${n.predictedDisplayTime}`),e("[START] - WebXR Body Tracking Module"),e(`bodyTracking = ${n.body.toString()}`),e("[END] - WebXR Body Tracking Module");let a=n.getViewerPose(y);if(a){e(`emulatedPosition = ${a.emulatedPosition}`),e(`angularVelocity = ${a.angularVelocity}`),e(`linearVelocity = ${a.linearVelocity}`);for(let o of a.views)e(`view.eye = ${o.eye}`),e(`view.recommendedViewportScale = ${o.recommendedViewportScale}`),e(`view.requestViewportScale = ${o.requestViewportScale}`);e(`views = ${a?.views}`)}else e(`xrViewerPose = ${JSON.stringify(a)}`)}async function u(t,n){try{return n.includes("depth-sensing")?await c.xr.requestSession("immersive-ar",{requiredFeatures:[...t,...n],optionalFeatures:["secondary-views"],depthSensing:{usagePreference:["cpu-optimized","gpu-optimized"],dataFormatPreference:["luminance-alpha","float32"]}}):await c.xr.requestSession("immersive-ar",{requiredFeatures:[...t,...n],optionalFeatures:["secondary-views"]})}catch(a){throw e(`requestSession error = ${a.toString()}`),new Error(a.toString())}}async function p(t){S(t);let n={antialias:!0,depth:!0,stencil:!1,alpha:!0,ignoreDepthValues:!1,framebufferScaleFactor:1},a={depthFar:1e3,depthNear:.1,passthroughFullyObscured:!1,inlineVerticalFieldOfView:Math.PI*.5,baseLayer:new l(t,new WebGL2RenderingContext,n)};t.updateRenderState(a),y=await t.requestReferenceSpace("unbounded"),t.requestAnimationFrame(v)}async function g(){i.featurePolicy.allowsFeature("xr-spatial-tracking")?e("xr-spatial-tracking is supported"):e("xr-spatial-tracking is not supported"),c.xr.addEventListener("devicechange",r=>{r.isTrusted&&e(`event = ${r.type}(${r.target})`)}),e("\u6A5F\u80FD\u78BA\u8A8D");let t=new Set,n=new Set;i.querySelectorAll(".label").forEach(r=>{r.addEventListener("click",s=>{s.isTrusted&&s.target.previousElementSibling.click()})}),i.addEventListener("dispatchReferenceType",async r=>{let s=await u(Array.from(t),Array.from(n));await p(s)}),i.addEventListener("dispatchModule",async r=>{let s=await u(Array.from(t),Array.from(n));await p(s)}),i.querySelectorAll(".referenceSpaceType").forEach(r=>{r.addEventListener("click",s=>{let d=s.target;d.checked?t.add(d.value):t.delete(d.value),i.dispatchEvent(new CustomEvent("dispatchReferenceType",{detail:t}))})}),i.querySelectorAll(".module").forEach(r=>{r.addEventListener("click",s=>{let d=s.target;d.checked?n.add(d.value):n.delete(d.value),i.dispatchEvent(new CustomEvent("dispatchModule",{detail:n}))})}),await m()}g();})();
