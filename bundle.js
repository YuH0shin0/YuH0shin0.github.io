"use strict";(()=>{var i=window.document;var s=window.navigator;function e(n){let t=i.getElementsByClassName("console-dom").item(0);t.textContent+=`${n}\r
`}var d={REFERENCE_SPACE_TYPE:"unbounded",DEPTH_SENSING:"depth-sensing"};async function p(){try{return await s.xr.requestSession("immersive-ar",{requiredFeatures:[d.DEPTH_SENSING],optionalFeatures:[],depthSensing:{usagePreference:["cpu-optimized","gpu-optimized"],dataFormatPreference:["luminance-alpha","float32"]}})}catch(n){throw e(`requestSession error = ${n.toString()}`),new Error}}async function c(){await s.xr.isSessionSupported("immersive-ar")?e("immersive-ar is supported"):e("immersive-ar is not supported")}function u(n){n.addEventListener("end",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("frameratechange",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("inputsourceschange",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("select",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("selectend",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("selectstart",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("squeeze",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("squeezeend",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("visibilitychange",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)})}function l(n){e(`session.enabledFeatures = ${n.enabledFeatures}`),e(`session.supportedFrameRates = ${n.supportedFrameRates}`),e(`session.frameRate = ${n.frameRate}`),e(`session.inputSources = ${JSON.stringify(n.inputSources)}`),n.inputSources.forEach(r=>{e(`inputSource.gripSpace = ${r.gripSpace}`);let a=r.gripSpace;e(`${a?.toString()}`),e(`inputSource.handedness = ${r.handedness}`),e(`inputSource.profiles = ${r.profiles}`),e(`inputSource.skipRendering = ${r.skipRendering}`),e(`inputSource.targetRayMode = ${r.targetRayMode}`),e(`inputSource.targetRaySpace = ${r.targetRaySpace}`),e(`${r?.targetRaySpace.toString()}`),r.hand&&(e(`hand = ${r.hand.size}`),e(`wrist = ${r.hand.get("wrist").jointName}`))}),e(`session.isSystemKeyboardSupported = ${n.isSystemKeyboardSupported}`),e(`session.renderState = ${JSON.stringify(n.renderState)}`),e(`session.visibilityState = ${n.visibilityState}`);let t=n.renderState;e(`renderState.baseLayer = ${t.baseLayer}`),e(`renderState.depthFar = ${t.depthFar}`),e(`renderState.depthNear = ${t.depthNear}`),e(`renderState.inlineVerticalFieldOfView = ${t.inlineVerticalFieldOfView}`),e(`renderState.passthroughFullyObscured = ${t.passthroughFullyObscured}`),e(`WebXR AR module = session.environmentBlendMode = ${n.environmentBlendMode}`),e(`WebXR AR module = session.environmentBlendMode = ${n.interactionMode}`),e(`WebXR Depth Sensing Module = session.depthUsage = ${n.depthUsage}`),e(`WebXR Depth Sensing Module = session.depthDataFormat = ${n.depthDataFormat}`),e(`WebXR Depth Sensing Module = session.depthType = ${n.depthType}`),e(`WebXR Depth Sensing Module = session.depthActive = ${n.depthActive}`)}var o=null;function y(n,t){e(`frameCallback of requestAnimationFrame(${n}, ${t})`),e(`session = ${t.session}`),e(`predictedDisplayTime = ${t.predictedDisplayTime}`),e(`bodyTracking = ${t.body}`);let r=t.getViewerPose(o);if(r){e(`emulatedPosition = ${r.emulatedPosition}`),e(`angularVelocity = ${r.angularVelocity}`),e(`linearVelocity = ${r.linearVelocity}`);for(let a of r.views)e(`view.eye = ${a.eye}`),e(`view.recommendedViewportScale = ${a.recommendedViewportScale}`),e(`view.requestViewportScale = ${a.requestViewportScale}`);e(`views = ${r?.views}`)}else e(`xrViewerPose = ${JSON.stringify(r)}`)}async function m(){let n=i.querySelector(".enter > button");n.textContent=n.classList.toString(),n.addEventListener("click",async t=>{if(!t.isTrusted)return;let r=await p();u(r),await r.updateTargetFrameRate(120);let a={depthFar:1e3,depthNear:.1,passthroughFullyObscured:!1,inlineVerticalFieldOfView:Math.PI*.5};r.updateRenderState(a),o=await r.requestReferenceSpace("viewer"),r.requestAnimationFrame(y),l(r)})}async function S(){i.featurePolicy.allowsFeature("xr-spatial-tracking")?e("xr-spatial-tracking is supported"):e("xr-spatial-tracking is not supported"),s.xr.addEventListener("devicechange",n=>{n.isTrusted&&e(`event = ${n.type}(${n.target})`)}),e("\u6A5F\u80FD\u78BA\u8A8D"),await c(),await m()}S();})();
