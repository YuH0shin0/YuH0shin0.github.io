"use strict";(()=>{var i=window.document;var s=window.navigator;function e(n){let t=i.getElementsByClassName("console-dom").item(0);t.textContent+=`${n}\r
`}var d="unbounded",p={REFERENCE_SPACE_TYPE:"unbounded",DEPTH_SENSING:"depth-sensing"};async function c(){try{return await s.xr.requestSession("immersive-ar",{requiredFeatures:[p.DEPTH_SENSING],optionalFeatures:[],depthSensing:{usagePreference:["cpu-optimized","gpu-optimized"],dataFormatPreference:["luminance-alpha","float32"]}})}catch(n){throw e(`requestSession error = ${n.toString()}`),new Error}}async function u(){await s.xr.isSessionSupported("immersive-ar")?e("immersive-ar is supported"):e("immersive-ar is not supported")}function l(n){n.addEventListener("end",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("frameratechange",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("inputsourceschange",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("select",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("selectend",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("selectstart",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("squeeze",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("squeezeend",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)}),n.addEventListener("visibilitychange",t=>{t.isTrusted&&e(`event = ${t.type}(${t.target})`)})}function y(n){e(`session.enabledFeatures = ${n.enabledFeatures}`),e(`session.supportedFrameRates = ${n.supportedFrameRates}`),e(`session.frameRate = ${n.frameRate}`),e(`session.inputSources = ${JSON.stringify(n.inputSources)}`),n.inputSources.forEach(a=>{e(`inputSource.gripSpace = ${a.gripSpace}`);let r=a.gripSpace;e(`${r?.toString()}`),e(`inputSource.handedness = ${a.handedness}`),e(`inputSource.profiles = ${a.profiles}`),e(`inputSource.skipRendering = ${a.skipRendering}`),e(`inputSource.targetRayMode = ${a.targetRayMode}`),e(`inputSource.targetRaySpace = ${a.targetRaySpace}`),e(`${a?.targetRaySpace.toString()}`),a.hand&&(e(`hand = ${a.hand.size}`),e(`wrist = ${a.hand.get("wrist").jointName}`))}),e(`session.isSystemKeyboardSupported = ${n.isSystemKeyboardSupported}`),e(`session.renderState = ${JSON.stringify(n.renderState)}`),e(`session.visibilityState = ${n.visibilityState}`);let t=n.renderState;e(`renderState.baseLayer = ${t.baseLayer}`),e(`renderState.depthFar = ${t.depthFar}`),e(`renderState.depthNear = ${t.depthNear}`),e(`renderState.inlineVerticalFieldOfView = ${t.inlineVerticalFieldOfView}`),e(`renderState.passthroughFullyObscured = ${t.passthroughFullyObscured}`),e(`WebXR AR module = session.environmentBlendMode = ${n.environmentBlendMode}`),e(`WebXR AR module = session.environmentBlendMode = ${n.interactionMode}`),e(`WebXR Depth Sensing Module = session.depthUsage = ${n.depthUsage}`),e(`WebXR Depth Sensing Module = session.depthDataFormat = ${n.depthDataFormat}`),e(`WebXR Depth Sensing Module = session.depthType = ${n.depthType}`),e(`WebXR Depth Sensing Module = session.depthActive = ${n.depthActive}`)}var o=null;function m(n,t){e(`frameCallback of requestAnimationFrame(${n}, ${t})`),e(`session = ${t.session}`),e(`predictedDisplayTime = ${t.predictedDisplayTime}`),e(`bodyTracking = ${t.body}`);let a=t.getViewerPose(o);if(a){e(`emulatedPosition = ${a.emulatedPosition}`),e(`angularVelocity = ${a.angularVelocity}`),e(`linearVelocity = ${a.linearVelocity}`);for(let r of a.views)e(`view.eye = ${r.eye}`),e(`view.recommendedViewportScale = ${r.recommendedViewportScale}`),e(`view.requestViewportScale = ${r.requestViewportScale}`);e(`views = ${a?.views}`)}else e(`xrViewerPose = ${JSON.stringify(a)}`)}async function S(){let n=i.querySelector(".enter > button");n.textContent=n.classList.toString(),n.addEventListener("click",async t=>{if(!t.isTrusted)return;let a=await c();l(a),await a.updateTargetFrameRate(120);let r={depthFar:1e3,depthNear:.1,passthroughFullyObscured:!1,inlineVerticalFieldOfView:Math.PI*.5};a.updateRenderState(r),o=await a.requestReferenceSpace(d),a.requestAnimationFrame(m),y(a)})}async function g(){i.featurePolicy.allowsFeature("xr-spatial-tracking")?e("xr-spatial-tracking is supported"):e("xr-spatial-tracking is not supported"),s.xr.addEventListener("devicechange",n=>{n.isTrusted&&e(`event = ${n.type}(${n.target})`)}),e("\u6A5F\u80FD\u78BA\u8A8D"),await u(),await S()}g();})();
