"use strict";(()=>{var m=window.document;var i=window.navigator;var u=class{constructor(n,r,s){return new window.XRWebGLLayer(n,r,s)}};function t(e){let n=document.getElementsByClassName("console-dom").item(0);n.textContent+=`${e}.    `}async function d(e){await i.xr.isSessionSupported(e)?t(`${e} is supported`):t(`${e} is not supported`)}async function l(e,n,r,s){let o={requiredFeatures:[...n],optionalFeatures:[...r,...s]};s.includes("depth-sensing")&&(o.depthSensing={usagePreference:["cpu-optimized","gpu-optimized"],dataFormatPreference:["luminance-alpha","float32"]}),Object.freeze(o);try{return await i.xr.requestSession(e,o)}catch(p){throw t(`requestSession error = ${p.toString()}`),new Error(p.toString())}}var S=new Set,L=new Set,v=new Set;function f(e,n){n.addEventListener("click",r=>{let s=r.target;s.checked?e.add(s.value):e.delete(s.value),document.dispatchEvent(new CustomEvent("dispatchRequestSession"))})}function F(e){e.addEventListener("click",n=>{n.isTrusted&&n.target.previousElementSibling.click()})}function y(e,n){document.addEventListener("dispatchRequestSession",async a=>{t(`${a.type} > ${a.target} > ${a.timeStamp}`);let h=await l(e,Array.from(S),Array.from(L),Array.from(v));await n(h)}),document.querySelectorAll(".label").forEach(a=>{F(a)}),document.querySelectorAll(".required-features").forEach(a=>{f(S,a)}),document.querySelectorAll(".optional-features").forEach(a=>{f(L,a)}),document.querySelectorAll(".module").forEach(a=>{f(v,a)})}function E(e){return m.featurePolicy.allowsFeature(e,window.origin)}var M=m.createElement("canvas"),g=M.getContext("webgl2",{xrCompatible:!0}),c=new Map;c.set("inline",null);c.set("immersive-ar",null);c.set("immersive-vr",null);function R(e,n){let r=n.session;r.requestAnimationFrame(R),g.bindFramebuffer(g.FRAMEBUFFER,r.renderState.baseLayer.framebuffer),t(`passthroughFullyObscured = ${r.renderState.passthroughFullyObscured}`),t(`baseLayer = ${r.renderState.baseLayer?.toString()}`),t(`session.renderState.baseLayer!.framebuffer = ${r.renderState.baseLayer.framebuffer.toString()}`)}function w(e){e.updateRenderState({baseLayer:new u(e,g)}),e.requestAnimationFrame(R)}async function b(){let e=await l("immersive-ar",["unbounded"],["camera-access"],[]);t(`running frame rate = ${e.frameRate}`),["end","inputsourceschange","select","selectstart","selectend","squeeze","squeezestart","squeezeend","visibilitychange","frameratechange"].forEach(s=>{e.addEventListener(s,o=>{t(`${o.type} > ${o.target} at ${o.timeStamp}`),s==="end"&&c.set("immersive-ar",null)})}),c.set("immersive-ar",e);let r=e.supportedFrameRates.at(-1);try{await e.updateTargetFrameRate(r)}catch(s){t(`session.updateTargetFrameRate(${r}) > error ${s.toString()}`)}w(e)}async function T(){E("xr-spatial-tracking")?t("xr-spatial-tracking is supported"):t("xr-spatial-tracking is not supported"),await d("immersive-ar"),await d("immersive-vr"),i.xr.addEventListener("devicechange",()=>{t("devicechange")}),y("immersive-ar",w),i.userActivation.hasBeenActive?await b():m.querySelector(".enter").addEventListener("click",async()=>{await b()})}T();})();
